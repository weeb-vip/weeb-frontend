server {
 listen 80;
 server_name frontend;

 root /usr/share/nginx/html;
 index index.html;

 # Handle Astro assets (_astro directory) with proper CORS and caching
 location /_astro/ {
   add_header Access-Control-Allow-Origin "*";
   add_header Cache-Control "public, immutable, max-age=31536000";
   expires 1y;
   try_files $uri =404;
 }

 # Cache other static assets
 location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
   add_header Access-Control-Allow-Origin "*";
   expires 1y;
   add_header Cache-Control "public, immutable";
   try_files $uri =404;
 }

 # Handle all show pages by serving the pre-generated show/1 page
 # The client-side JS will handle the actual ID from the URL
 location ~* ^/show/.*$ {
   try_files /show/1/index.html /404.html;
 }

 # Serve static files and Astro pages
 location / {
   try_files $uri $uri/ $uri.html $uri/index.html /404.html;
 }

 # Security headers
 add_header X-Frame-Options "SAMEORIGIN" always;
 add_header X-Content-Type-Options "nosniff" always;
 add_header X-XSS-Protection "1; mode=block" always;

 # Compression
 gzip on;
 gzip_vary on;
 gzip_min_length 1024;
 gzip_types text/plain text/css text/xml text/javascript application/javascript application/json application/xml+rss;
}
